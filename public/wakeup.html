<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>TEAM- ABCD Google Plus Theme</title>
    <meta name="generator" content="Bootply">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-fixed-top header">
        <div class="col-md-12">
            <div class="navbar-header">

                <a href="#" class="navbar-brand">Facile Rail</a>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse1">
                    <i class="glyphicon glyphicon-search"></i>
                </button>

            </div>
            <div class="collapse navbar-collapse" id="navbar-collapse1">
                <form class="navbar-form pull-left">
                    <div class="input-group" style="max-width:470px;">
                        <input type="text" class="form-control" placeholder="Search" name="srch-term" id="srch-term">
                        <div class="input-group-btn">
                            <button class="btn btn-default btn-primary" type="submit"><i class="glyphicon glyphicon-search"></i>
                            </button>
                        </div>
                    </div>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://www.bootply.com" target="_ext">Bootply+</a>
                    </li>
                    <li>
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-bell"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="#"><span class="badge pull-right">40</span>Link</a>
                            </li>
                            <li><a href="#"><span class="badge pull-right">2</span>Link</a>
                            </li>
                            <li><a href="#"><span class="badge pull-right">0</span>Link</a>
                            </li>
                            <li><a href="#"><span class="label label-info pull-right">1</span>Link</a>
                            </li>
                            <li><a href="#"><span class="badge pull-right">13</span>Link</a>
                            </li>
                        </ul>
                    </li>
                    <li><a href="#" id="btnToggle"><i class="glyphicon glyphicon-th-large"></i></a>
                    </li>
                    <li><a href="#"><i class="glyphicon glyphicon-user"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="navbar navbar-default" id="subnav">
        <div class="col-md-12">
            <div class="navbar-header">

                <a href="#" style="margin-left:15px;" class="navbar-btn btn btn-default btn-plus dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-home" style="color:#dd1111;"></i> Home <small><i class="glyphicon glyphicon-chevron-down"></i></small></a>
                <ul class="nav dropdown-menu">
                    <li><a href="#"><i class="glyphicon glyphicon-user" style="color:#1111dd;"></i> Profile</a>
                    </li>
                    <li><a href="#"><i class="glyphicon glyphicon-dashboard" style="color:#0000aa;"></i> Dashboard</a>
                    </li>
                    <li><a href="#"><i class="glyphicon glyphicon-inbox" style="color:#11dd11;"></i> Pages</a>
                    </li>
                    <li class="nav-divider"></li>
                    <li><a href="#"><i class="glyphicon glyphicon-cog" style="color:#dd1111;"></i> Settings</a>
                    </li>
                    <li><a href="#"><i class="glyphicon glyphicon-plus"></i> More..</a>
                    </li>
                </ul>


                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse2">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>
            <div class="collapse navbar-collapse" id="navbar-collapse2">
                <ul class="nav navbar-nav navbar-right">
                    <li class="active"><a href="#">Posts</a>
                    </li>
                    <li><a href="#loginModal" role="button" data-toggle="modal">Login</a>
                    </li>
                    <li><a href="#aboutModal" role="button" data-toggle="modal">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!--main-->
    <div class="container" id="main">
        <div class="row">
            <div class="col-md-12 col-sm-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4>Add Wake Me Up</h4>
                    </div>
                    <div class="panel-body">
                        <div class="well"> 
           <!--   <form class="form">
              <h4>Enter PNR</h4>
              <h7>PNR No: 2400938094</h7>
              <div class="input-group text-center">
              <input type="text" id="wakeInput" class="form-control input-lg" placeholder="Enter your PNR Number">
                <span class="input-group-btn"><button id="wakeBtn" class="btn btn-lg btn-primary" type="button">Add Wake Me Up</button></span>
              </div>
            </form> -->

        <form class="form-horizontal">
            <div class="form-group">
                <label for="inputEmail3" class="col-sm-3 control-label">Enter PNR</label>
                <div class="col-sm-9">
                    <input type="text" value="2400938094" class="form-control" id="wakeInput" autofocus="" placeholder="Enter your PNR Number">
                </div>
            </div>
            <div class="form-group">
                <label for="inputPassword3" class="col-sm-3 control-label">Alarm Type</label>
                <div class="col-sm-9">
                    <select class="form-control" id="inputPassword3">
                        <option>Before 10 mins</option>
                        <option>On Second Last Station</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-3 col-sm-9">
                    <button id="wakeBtn" type="submit" class="btn btn-success">Add Wake Me Up</button>
                </div>
            </div>
        </form>


            <div id="destDiv"></div>
          </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/row-->
        <div class="row">
            <div class="col-md-12 col-sm-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4>All Wake me Up Alarm Information</h4>
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped table-bordered table-hover table-responsive" id="wakeMeUpTable">
                            <thead>
                                <tr>
                                    <th>Train Name </th>
                                    <th>PNR No </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FZR BCT JANATA</td>
                                    <td>1423938032</td>
                                </tr>
                                <tr>
                                    <td>Shram Shakti Express</td>
                                    <td>4442988024</td>
                                </tr>
                                <tr>
                                    <td>Farakka Express</td>
                                    <td>1423938094</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="table table-striped table-bordered table-hover table-responsive" id="wakeMeUpTable">
                            <thead>
                                <tr>
                                    <th>Source Station</th>
                                    <th>Destination Station</th>
                                    <th>Wake Me Up Alarm Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>New Delhi</td>
                                    <td>Agra</td>
                                    <td>27-Oct-15 02:00</td>
                                </tr>
                                <tr>
                                    <td>Kanpur</td>
                                    <td>Delhi</td>
                                    <td>23-Mar-15 16:32</td>
                                </tr>
                                <tr>
                                    <td>Chennai</td>
                                    <td>Delhi</td>
                                    <td>18-Sep-15 19:20</td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </div>
        <!--/row-->
    </div>
    <!--/main-->
    <!-- script references -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/scripts.js"></script>
    <script src="js/main.js"></script>
    <script>
        function subtractTime(date,hours,minutes) {
                 
            var output = date.substr(0, 7) + "20" + date.substr(7);
            output = output.replace(/-/g, "/");
     
            months = {
                'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04', 'May': '05',
                'Jun': '06', 'Jul': '07', 'Aug': '08', 'Sep': '09', 'Oct': '10', 'Nov': '11',
                'Dec': '12'
            };
     
           split = output.split('/');
           var newdate= [months[split[1]], split[0], split[2]].join('/');            
           var clock = new Date().subTime(newdate, hours, minutes).toLocaleString();
           var clock1 = convertTo24Hour(clock);      
           //var time = clock1.substring(0, clock1.length - 4);     
           return clock1;       
        }
     
        Date.prototype.subTime = function (d, h, m) {
            dt = new Date(d);
            dt.setHours(dt.getHours() - h);
            dt.setMinutes(dt.getMinutes() - m);
            return dt;
        }
     
        function convertTo24Hour(time) {
        
            var arr = time.split(',');
            var hours = arr[1];
            var hour = hours.split(':');    
            if (time.indexOf('AM') != -1 && hour[0] == 12) {
                hour[0] = 0;           
            }
            if (time.indexOf('PM') != -1 && hour[0] < 12) {
                hour[0] = +hour[0] + +12;          
            }
            var finalTime = arr[0] + " at " + hour[0] + ":" + hour[1];
            console.log(finalTime);
            return finalTime;    
        }
    </script>
    <script type="text/javascript">
      $(document).ready(function(){
        $("#wakeBtn").click(function(){
        var task = "pnr";
        var query = "pnr="+$("#wakeInput").val();
        // Returns successful data submission message when the entered information is stored in database.
        var dataString = 'task='+ task+'&query='+ query;
        if(query=='')
        {
        alert("Please Fill All Fields");
        }
        else
        {
        // AJAX Code To Submit Form.
        $.ajax({
            type: "GET",
            url: "php/proxy.php",
            data: dataString,
            cache: false,
            crossDomain : true,
            contentType: "application/json",
            success: function(result){
                var trainno = result.result.trainno;
                //var trainno = 12452;
                var journeyDate = result.result.journey;
                var bording = result.result.to;
                var wakeQuery = encodeURIComponent('trainno='+trainno+'&stnfrom='+bording+'&date='+journeyDate);
                var wakeTask = 'live';


                // test
                //  var wakeQuery = encodeURIComponent('trainno='+trainno);
                // var wakeTask = 'fullroute';
                // console.log('train no is'+trainno);
                // var wakeString = 'task='+ wakeTask+'&query='+ wakeQuery;
                // test
                //console.log('train no is'+trainno);


                var wakeString = 'task='+ wakeTask+'&query='+ wakeQuery;
                $.ajax({
                    type: "GET",
                    url: "php/proxy.php",
                    data: wakeString,
                    cache: false,
                    crossDomain : true,
                    contentType: "application/json",
                    success: function(wakeUp){
                        console.log(wakeUp);
                        // old
                        var scharr = wakeUp.result.scharr;
                        var scharr = subtractTime(scharr, 0, 10);
                        console.log("Destination Station Reach Time is"+scharr);
                        $('#destDiv').html("Your Train <b>"+result.result.name+"</b> running from <b>"+result.result.brdg+"</b> to <b>"+result.result.to+"</b>. Your phone will ring Wake Up Alarm at around <b>"+scharr+"</b>");
                        $("#wakeMeUpTable1 tbody").append("<tr><td>"+result.result.name+"</td><td>"+$("#wakeInput").val()+"</td></tr>");

                        $("#wakeMeUpTable2 tbody").append("<tr>><td>"+result.result.brdg+"</td><td>"+result.result.to+"</td><td>"+scharr+"</td></tr>");
                        // old
    
                    }
                });
            }
        });
        }
        return false;
        });
      });
    </script>
</body>
</html>